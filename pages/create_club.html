<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Club</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <!-- <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js"></script> -->
    <!-- <script type="module" src="/js/index.js"></script> -->
    <!-- Add these scripts before your bundle.js script -->
    <!-- --------------bootstrap------- -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />

    <!-- ----- script-------- -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <script src="/js/index.js"></script>
    <s-header></s-header>

    <div class="col-md-6 login-container offset-md-4 mt-3 mb-3">
      <h1>Create Club</h1>
    </div>
    <div id="container ">
      <div class="row">
        <div class="col-md-6 col-sm-6 offset-sm-3 offset-md-4">
          <form class="row g-3">
            <div class="col-12">
              <label for="clubname" class="form-label col-9"
                >Club Name
                <input type="text" id="clubname" class="form-control" />
              </label>
            </div>
            <div class="col-12">
              <label for="sport" class="form-label col-9"
                >Sport<input type="text" id="sport" class="form-control"
              /></label>
            </div>
            <div class="col-9">
              <label for="clubdescription" class="form-label"
                >Club Description</label
              >
              <textarea
                name=""
                id="clubdescription"
                cols="4"
                rows="4"
                class="form-control"
              ></textarea>
            </div>
            <div class="col-12">
              <label for="uploadImage" class="form-label col-9"
                >Upload Image<input
                  type="file"
                  class="form-control"
                  id="uploadImage"
                  accept="/image"
              /></label>
            </div>
            <div class="col-12">
              <label for="location" class="form-label col-9"
                >Location<input type="text" id="location" class="form-control"
              /></label>
            </div>
            <div class="col-9 d-grid">
              <input type="submit" id="submit" class="btn btn-success" />
            </div>
          </form>
        </div>
      </div>
      <!-- <div class="col-6 d-grid justify-content">
        <button id="getData" class="btn btn-warning offset-md-3 mt-3">
          Get Data
        </button>
      </div> -->
    </div>
    <script>
      // Initialize the Google Places Autocomplete
      var autocomplete;
      let clubLocation;
      function initAutocomplete() {
        console.log("Autocomplete initialized");
        autocomplete = new google.maps.places.Autocomplete(
          document.getElementById("location"),
          { types: ["geocode"] }
        );
        autocomplete.addListener("place_changed", onPlaceChanged);
      }

      function onPlaceChanged() {
        var place = autocomplete.getPlace();
        console.log("Selected Place:", place);

        // Assuming your object is named 'locationObject'

        // Accessing the geometry object
        const geometry = place.geometry;

        // Accessing the location object within geometry
        const location = geometry.location;

        // Extracting latitude and longitude
        const latitude = location.lat(); // lat() function retrieves the latitude
        const longitude = location.lng(); // lng() function retrieves the longitude

        console.log("Latitude:", latitude);
        console.log("Longitude:", longitude);

        clubLocation = { Latitude: latitude, Longitude: longitude };
        //   console.log(clubLocation)
        // You can access various details of the selected place here and use them as needed.
        // For example, place.formatted_address, place.geometry.location.lat(), place.geometry.location.lng(), etc.
      }
    </script>

    <script
      type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpN1dFF_d3RhD-ndBd3dGpapZqFAPS7O0&libraries=places&callback=initAutocomplete"
    ></script>
    <script>
      // Manual initialization after the script has loaded
      document.addEventListener("DOMContentLoaded", function () {
        initAutocomplete();
      });
    </script>

    <!--  -->
    <!--  -->

    <script type="module">
      import {
        getStorage,
        ref,
        uploadBytesResumable,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-storage.js";

      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import {
        getDatabase,
        set,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

      //Chitransh Firebase
      // const firebaseConfig = {
      // apiKey: "AIzaSyDpN1dFF_d3RhD-ndBd3dGpapZqFAPS7O0",
      // authDomain: "test-7d410.firebaseapp.com",
      // projectId: "test-7d410",
      // storageBucket: "test-7d410.appspot.com",
      // messagingSenderId: "1090057594905",
      // appId: "1:1090057594905:web:ca3f2b2bef00bbb86a2288"
      // };
      //Kartavya Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyC3L-pygyvZqYOGp5Os7swV54Mhno1To88",
        authDomain: "test-8e125.firebaseapp.com",
        databaseURL: "https://test-8e125-default-rtdb.firebaseio.com",
        projectId: "test-8e125",
        storageBucket: "test-8e125.appspot.com",
        messagingSenderId: "675271753145",
        appId: "1:675271753145:web:0f2070f6b149b210608a68",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      const db = getFirestore(app);

      // Initialize Realtime Database and get a reference to the service
      //   const database = getDatabase(app);

      const locationInput = document.getElementById("location");

      // locationInput.addEventListener("input", function () {
      //   const inputText = this.value;
      //   console.log("Input changed:", inputText);
      //   if (inputText.length >= 3) {
      //   }
      // });
      let autocompleteEnabled = true; // Flag to track whether autocomplete is enabled

      locationInput.addEventListener("input", function () {
        if (autocompleteEnabled) {
          const inputText = this.value;
          console.log("Input changed:", inputText);
          if (inputText.length >= 3) {
            // Perform autocomplete suggestions
          }
        }
      });
      locationInput.addEventListener("keydown", function () {
        autocompleteEnabled = false;
      });
      locationInput.addEventListener("blur", function () {
        autocompleteEnabled = true;
      });

      let data = {};
      var addressOfImage = "";

      document.getElementById("submit").addEventListener("click", (event) => {
        event.preventDefault();

        let uploadImageInput = document.getElementById("uploadImage");
        const file = uploadImageInput.files[0];
        if (file && file.type.startsWith("image/")) {
          var storage = getStorage();
          var storageRef = ref(storage, "images/" + file.name);
          const metadata = {
            contentType: "image/jpeg",
          };
          const uploadTask = uploadBytesResumable(storageRef, file, metadata);
          console.log(uploadTask);
          uploadTask.on(
            "state_changed",
            (snapshot) => {
              const progress =
                (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              console.log("Upload is " + progress + "% done");
              switch (snapshot.state) {
                case "paused":
                  console.log("Upload is paused");
                  break;
                case "running":
                  console.log("Upload is running");
                  break;
              }
            },
            (error) => {
              // Handle unsuccessful uploads
            },
            () => {
              getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                addressOfImage = downloadURL;
                console.log("File available at", downloadURL, addressOfImage);
                submitForm();
              });
            }
          );
        } else {
          console.error("Invalid file type. Please select an image.");
        }
      });
      const submitForm = async () => {
        let clubName = document.getElementById("clubname").value;
        let sport = document.getElementById("sport").value;
        let clubDescription = document.getElementById("clubdescription").value;
        let clubImage = document.querySelector("#uploadImage").value;

        console.log(clubLocation);
        let clubDetails = {
          lat: clubLocation.Latitude,
          long: clubLocation.Longitude,
          address: locationInput.value,
        };
        let user = JSON.parse(localStorage.getItem("user"));
        console.log(user.uid, "USERRRRR");
        data = {
          clubName: clubName,
          Sport: sport,
          clubDescription: clubDescription,
          image: clubImage,
          addressOfImage: addressOfImage,
          // "location":locationInput.value,
          clubDetails: clubDetails,
          admin_id: user.uid,
          club_requests: {
            pending_requests: [],
            approved_requests: [],
            declined_requests: [],
          },

          // Add other fields if needed
        };
        console.log(data);
        // Call the writeUserData function
        // writeUserData(data);
        // createClub(data);
        // };
        // async function createClub(data) {
        try {
          console.log(data);
          // Get a reference to the "clubs" collection
          const clubsCollectionRef = collection(db, "clubs");

          // Add club document to "clubs" collection

          const clubDocRef = await addDoc(clubsCollectionRef, {
            clubName: clubName,
            Sport: sport,
            clubDescription: clubDescription,
            addressOfImage: addressOfImage,
            // "location":locationInput.value,
            clubDetails: clubDetails,
            admin_id: user.uid,

            // club_requests:{
            //   pending_requests:[],
            //   approved_requests:[],
            //   declined_requests:[],
            // }
          });
          alert("Club Store Successfully Added");
          console.log("Club created successfully with ID: ", clubDocRef.id);
        } catch (error) {
          console.error("Error creating club: ", error);
          alert(error);
        }
      };
    </script>
  </body>
</html>
