<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Club</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <!-- <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js"></script> -->
    <!-- <script type="module" src="/js/index.js"></script> -->
    <!-- Add these scripts before your bundle.js script -->
  </head>
  <body>
    <h1>Create Club</h1>
    <div id="container">
      <form>
        <label for="clubname"
          >Club Name
          <input type="text" id="clubname" />
        </label>
        <label for="sport">Sport<input type="text" id="sport" /></label>
        <label for="clubdescription">Club Description</label>
        <textarea name="" id="clubdescription" cols="10" rows="10"></textarea>
        <!-- <label for="address">Address<input type="text" id="address"></label>
            <label for="country">Country<input type="text" id="country"></label>
            <label for="postalcode">Postal/Zip Code<input type="text" id="postalcode"></label> -->
        <label for="uploadImage"
          >Upload Image<input type="file" id="uploadImage"
        /></label>
        <label for="location"
          >Location<input type="text" id="location"
        /></label>
        <input type="submit" id="submit" />
      </form>
      <button id="getData">Get Data</button>
    </div>
    <script>
      // Initialize the Google Places Autocomplete
      var autocomplete;
      let clubLocation;
      function initAutocomplete() {
        console.log("Autocomplete initialized");
        autocomplete = new google.maps.places.Autocomplete(
          document.getElementById("location"),
          { types: ["geocode"] }
        );
        autocomplete.addListener("place_changed", onPlaceChanged);
      }

      function onPlaceChanged() {
        var place = autocomplete.getPlace();
        console.log("Selected Place:", place);

        // Assuming your object is named 'locationObject'

        // Accessing the geometry object
        const geometry = place.geometry;

        // Accessing the location object within geometry
        const location = geometry.location;

        // Extracting latitude and longitude
        const latitude = location.lat(); // lat() function retrieves the latitude
        const longitude = location.lng(); // lng() function retrieves the longitude

        console.log("Latitude:", latitude);
        console.log("Longitude:", longitude);

        clubLocation = { Latitude: latitude, Longitude: longitude };
        //   console.log(clubLocation)
        // You can access various details of the selected place here and use them as needed.
        // For example, place.formatted_address, place.geometry.location.lat(), place.geometry.location.lng(), etc.
      }
    </script>
    <script
      type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-Q7mYO3nAs-IhehNcm3QGQT4sCNwR37c&libraries=places&callback=initAutocomplete"
    ></script>
    <script>
      // Manual initialization after the script has loaded
      document.addEventListener("DOMContentLoaded", function () {
        initAutocomplete();
      });
    </script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

   
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyC3L-pygyvZqYOGp5Os7swV54Mhno1To88",
        authDomain: "test-8e125.firebaseapp.com",
        databaseURL: "https://test-8e125-default-rtdb.firebaseio.com",
        projectId: "test-8e125",
        storageBucket: "test-8e125.appspot.com",
        messagingSenderId: "675271753145",
        appId: "1:675271753145:web:0f2070f6b149b210608a68",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      const db = getFirestore(app);

      // Initialize Realtime Database and get a reference to the service
    //   const database = getDatabase(app);

      const locationInput = document.getElementById("location");

      locationInput.addEventListener("input", function () {
        const inputText = this.value;
        console.log("Input changed:", inputText);
        if (inputText.length >= 3) {
        }
      });

      let data = {};
      document.getElementById("submit").addEventListener("click", (event) => {
        event.preventDefault();
        submitForm();
      });
      let submitForm = () => {
        let clubName = document.getElementById("clubname").value;
        let sport = document.getElementById("sport").value;
        let clubDescription = document.getElementById("clubdescription").value;
       
        console.log(clubLocation);
        let clubDetails = {
          lat: clubLocation.Latitude,
          long: clubLocation.Longitude,
          address: locationInput.value,
        };
        let user = JSON.parse(localStorage.getItem("user"));
        console.log(user.uid,"USERRRRR");
        data = {
          clubName: clubName,
          Sport: sport,
          clubDescription: clubDescription,
          // "location":locationInput.value,
          clubDetails: clubDetails,
          uuid: user.uid,
          // Add other fields if needed
        };
        console.log(data);
        // Call the writeUserData function
        // writeUserData(data);
        createClub(data);
      };
      async function createClub(data) {
        try {
            console.log(data);
          // Get a reference to the "clubs" collection
          const clubsCollectionRef = collection(db, "clubs");

          // Add club document to "clubs" collection
          const clubDocRef = await addDoc(clubsCollectionRef, {
            data,
          });
          alert("Club Store Successfully Added");
          console.log("Club created successfully with ID: ", clubDocRef.id);
        } catch (error) {
          console.error("Error creating club: ", error);
          alert(error);
        }
      }

      // Call the createClub function
      // createClub("zAuTYTmuOcgGFjI0daHLLCXjZPX2", "My Club", "Club Description");
      // Define the writeUserData function outside of submitForm
      // function writeUserData(data) {
      //     const db = getDatabase();
      //     set(ref(db, 'users/' + data.clubName), data)
      //         .then(() => {
      //             console.log("Data written successfully");
      //         })
      //         .catch((error) => {
      //             console.error("Error writing data: ", error);
      //         });
      // }
    </script>
  </body>
</html>
